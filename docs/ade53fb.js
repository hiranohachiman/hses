(window.webpackJsonp=window.webpackJsonp||[]).push([[6,3],{287:function(e,t,o){"use strict";o.r(t);o(202);var r={name:"BuefyCard",components:{VueEllipseProgress:o(144).VueEllipseProgress},props:{progress:{type:Number,required:!0},count:{type:Number,required:!0}},created:function(){},data:function(){return{gradient:{radial:!1,colors:[{color:"#6546f7",offset:"0",opacity:"1"},{color:"lime",offset:"100",opacity:"0.6"}]}}}},n=o(49),component=Object(n.a)(r,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"mx-auto items-center"},[t("div",{staticClass:"max-w-xl mx-auto text-center"},[t("p",{staticClass:"text-2xl mt-5 mb-5"},[e._v(" Cited by ")]),e._v(" "),t("vue-ellipse-progress",{attrs:{data:e.circles,progress:e.progress,angle:-90,color:e.gradient,size:200,lineMode:"normal",legend:!0,legendClass:"legend-custom-style",animation:"reverse 700 400",noData:!1,loading:!1,fontColor:"#000",half:!1,gap:10,reverse:"",colorFill:e.colorFillGradient,legendValue:100,thickness:10}},[t("p",{staticClass:"text-4xl"},[e._v(e._s(e.count))])])],1)])}),[],!1,null,null,null);t.default=component.exports},336:function(e,t,o){"use strict";o.r(t);o(291);var r=o(16),n=o(332),l=o(10),c=(o(50),o(89),o(305),o(32),o(51),o(52),o(53),o(67),o(54),o(42),o(43),o(21),o(25),o(44),o(68),o(33),o(34),o(35),o(287));function d(e,t){var o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!o){if(Array.isArray(e)||(o=function(e,a){if(e){if("string"==typeof e)return f(e,a);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?f(e,a):void 0}}(e))||t&&e&&"number"==typeof e.length){o&&(e=o);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,a=!0,u=!1;return{s:function(){o=o.call(e)},n:function(){var e=o.next();return a=e.done,e},e:function(e){u=!0,l=e},f:function(){try{a||null==o.return||o.return()}finally{if(u)throw l}}}}function f(e,a){(null==a||a>e.length)&&(a=e.length);for(var t=0,o=Array(a);t<a;t++)o[t]=e[t];return o}var m=o(307),v={name:"IndexPage",components:{Card:c.default},created:function(){var e=this;return Object(l.a)(regeneratorRuntime.mark((function t(){var o,r,n,l,c,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,console.log("=== ページが読み込まれました ==="),console.log("Vue.js が動作しています"),console.log("環境:","production"),console.log("現在のURL:",window.location.href),o=e.$route.params.page,r=e.$route.query.username,console.log("ルートパラメータ:",{page:o,username:r}),console.log("$route全体:",e.$route),!(o<=0||o>20)){t.next=13;break}return console.log("不正なページ番号:",o),e.$buefy.toast.open({message:"不正なURLです",type:"is-danger"}),t.abrupt("return");case 13:if(n=e.getCookie("current"),console.log("saved:",n),!n){t.next=20;break}console.log("Cookieからデータを復元"),e.items=n,t.next=42;break;case 20:return console.log("APIからデータを取得開始"),e.isLoading=!0,t.prev=22,t.next=25,e.callApi("fetchid?username="+r);case 25:return l=t.sent,console.log("userIndex取得完了:",l),c=parseInt(l)+10*(parseInt(o)-1),console.log("計算されたindex:",c),t.next=31,e.callApi("fetch?index="+c);case 31:d=t.sent,console.log("取得したitems:",d),e.items=d,e.isLoading=!1,t.next=42;break;case 37:t.prev=37,t.t0=t.catch(22),console.error("API呼び出し中にエラー:",t.t0),e.isLoading=!1,e.$buefy.toast.open({message:"データの取得に失敗しました: "+t.t0.message,type:"is-danger"});case 42:e.page=o,e.nextLink=20!=o?"/exp/"+(parseInt(o)+1)+"?username="+r:"/term",console.log("設定完了:"),console.log("- items数:",e.items.length),console.log("- nextLink:",e.nextLink),e.items.forEach((function(t,o){console.log("アイテム".concat(o,":"),{id:t.id,url:t.url,caption:t.caption,isVideo:e.isVideo(t.url||"")})})),e.startTime=new Date,console.log("created完了"),t.next=55;break;case 52:t.prev=52,t.t1=t.catch(0),console.error("created内でエラー:",t.t1);case 55:case"end":return t.stop()}}),t,null,[[0,52],[22,37]])})))()},mounted:function(){console.log("=== DOM が完全に読み込まれました ==="),console.log("アイテム数 (mounted):",this.items.length),console.log("現在のitems:",this.items);var e=document.querySelectorAll("video"),t=document.querySelectorAll("img");console.log("DOM内の動画要素数:",e.length),console.log("DOM内の画像要素数:",t.length)},methods:{execute:function(){var e=this;return Object(l.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.fullFill()){t.next=3;break}return e.$buefy.toast.open({message:"全ての項目に回答してください",type:"is-danger"}),t.abrupt("return");case 3:return e.isLoading=!0,t.next=6,e.sendResults();case 6:e.eraseCookie("current"),e.isLoading=!1,e.$router.push(e.nextLink);case 9:case"end":return t.stop()}}),t)})))()},fullFill:function(){for(var i=0;i<this.radio.length;i++)if("-1"==this.radio[i])return!1;return!0},sendResults:function(){var e=this;return Object(l.a)(regeneratorRuntime.mark((function t(){var o,time,r,body,i,n,l,c,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(o=new Date,time=(o-e.startTime)/1e3,console.log("time",time),e.$buefy.toast.open({message:"結果を送信しています",type:"is-success"}),r=e.$route.query.username,body=[],i=0;i<e.items.length;i++)n={username:r,caption_id:e.items[i].id,type:"M3",mos:parseInt(e.radio[i]),time:time},body.push(n);return t.prev=7,l=e.getApiUrl("aggregate"),t.next=11,m.post(l,body);case 11:c=t.sent,d=JSON.parse(JSON.stringify(c.data)),console.log("aggregate:",d),e.$buefy.toast.open({message:"結果を正常に送信しました",type:"is-success"}),t.next=23;break;case 17:t.prev=17,t.t0=t.catch(7),console.error("結果送信エラー:",t.t0),console.log("送信予定だったデータ:",body),e.$buefy.toast.open({message:"APIサーバーに接続できないため、結果はローカルに保存されました（テストモード）",type:"is-warning"}),localStorage.setItem("test_results_"+(new Date).getTime(),JSON.stringify(body));case 23:case"end":return t.stop()}}),t,null,[[7,17]])})))()},getApiUrl:function(e){return"https://patrick-back-f238203eb2a4.herokuapp.com/"+e},callApi:function(e){var t=this;return Object(l.a)(regeneratorRuntime.mark((function o(){var l,c,d,f;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,l=t.getApiUrl(e),console.log("=== API呼び出し開始 ==="),console.log("API URL:",l),console.log("Suffix:",e),o.next=7,fetch(l);case 7:if(c=o.sent,console.log("Response status:",c.status),console.log("Response headers:",Object(n.a)(c.headers.entries())),c.ok){o.next=12;break}throw new Error("HTTP error! status: ".concat(c.status));case 12:return o.next=14,c.json();case 14:return d=o.sent,console.log("API応答データ:",d),console.log("データタイプ:",Object(r.a)(d)),console.log("データ長:",Array.isArray(d)?d.length:"not array"),t.saveCookie("current",d),console.log("Cookie保存完了"),o.abrupt("return",d);case 23:if(o.prev=23,o.t0=o.catch(0),console.error("=== API呼び出しエラー ==="),console.error("エラー詳細:",o.t0),console.error("エラーメッセージ:",o.t0.message),console.error("エラースタック:",o.t0.stack),console.log("=== モックデータを使用 ==="),!e.includes("fetchid")){o.next=33;break}return console.log("モック userIndex を返す: 0"),o.abrupt("return",0);case 33:if(!e.includes("fetch?index=")){o.next=37;break}return f=[{id:1,url:"https://via.placeholder.com/400x300/0066cc/ffffff?text=Test+Image+1",caption:"これはテスト用の画像1です。青い背景に白いテキストが表示されています。"},{id:2,url:"https://via.placeholder.com/400x300/cc6600/ffffff?text=Test+Image+2",caption:"これはテスト用の画像2です。オレンジ色の背景に白いテキストが表示されています。"},{id:3,url:"https://via.placeholder.com/400x300/006600/ffffff?text=Test+Image+3",caption:"これはテスト用の画像3です。緑色の背景に白いテキストが表示されています。"}],console.log("モックデータを返す:",f),o.abrupt("return",f);case 37:return t.$buefy.toast.open({message:"APIサーバーに接続できないため、テストデータを使用しています",type:"is-warning"}),o.abrupt("return",[]);case 39:case"end":return o.stop()}}),o,null,[[0,23]])})))()},getCookie:function(e){var t,o=d(document.cookie.split(";"));try{for(o.s();!(t=o.n()).done;){var r=t.value.split("="),n=r[0],l=r[1];if(console.log("cookie",'"'+n+'"','"'+e+'"'),n==e)return JSON.parse(decodeURIComponent(l))}}catch(e){o.e(e)}finally{o.f()}},saveCookie:function(e,t){document.cookie=e+"="+encodeURIComponent(JSON.stringify(t))},eraseCookie:function(e){document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC;"},isVideo:function(e){if(!e)return console.log("URL is empty or null"),!1;var t=/\.(mp4|webm|ogg|avi|mov|wmv|flv|mkv|m4v)$/i.test(e.trim());return console.log("URL: ".concat(e,", isVideo: ").concat(t)),t},onVideoError:function(e,t){console.error("動画の読み込みエラー:",e),this.mediaErrors[t]=!0},onImageError:function(e,t){console.error("画像の読み込みエラー:",e),this.mediaErrors[t]=!0},onMediaLoadStart:function(e){console.log("メディアの読み込み開始: ".concat(e))},onMediaLoaded:function(e){console.log("メディアの読み込み完了: ".concat(e))}},data:function(){return{isLoading:!1,mainDescription:"文章がどれほど画像の特徴を捉えているかを5段階で評価してください。",instruction:null,radio:Array(10).fill("-1"),items:[],page:-1,nextLink:"exp/2",startTime:null,mediaErrors:Array(10).fill(!1)}}},x=o(49),component=Object(x.a)(v,(function(){var e=this,t=e._self._c;return t("section",{staticClass:"bg-gray-50"},[t("div",{staticClass:"px-4 pt-16 mx-auto max-w-screen-xl lg:h-4/6 lg:items-center lg:flex"},[t("div",{staticClass:"max-w-xl mx-auto"},[t("p",{staticClass:"text-center font-bold"}),e._v(" "),t("p",{staticClass:"text-center text-2xl font-bold"},[e._v(e._s(e.mainDescription))]),e._v(" "),e._m(0),e._v(" "),t("div",{staticClass:"mt-10 mb-5 text-center"},[t("b-loading",{attrs:{"is-full-page":!1,"can-cancel":!1},model:{value:e.isLoading,callback:function(t){e.isLoading=t},expression:"isLoading"}}),e._v(" "),t("div",{staticClass:"mb-5 p-3 bg-yellow-100 border border-yellow-300 rounded text-sm text-left"},[t("h4",{staticClass:"font-bold"},[e._v("デバッグ情報:")]),e._v(" "),t("p",[e._v("アイテム数: "+e._s(e.items.length))]),e._v(" "),t("p",[e._v("ページ: "+e._s(e.page))]),e._v(" "),t("p",[e._v("ローディング中: "+e._s(e.isLoading))]),e._v(" "),t("p",[e._v("現在時刻: "+e._s((new Date).toLocaleString()))])]),e._v(" "),0===e.items.length?t("div",{staticClass:"text-center text-red-500 p-5"},[t("p",[e._v("データが読み込まれていません。")]),e._v(" "),t("p",[e._v("ブラウザのコンソールを確認してください。")])]):e._e(),e._v(" "),e._l(e.items,(function(o,r){return t("div",{key:r,staticClass:"flex-col mt-5 p-5 border border-gray-200 rounded-2xl shadow-2xl"},[t("div",[t("span",{staticStyle:{color:"red"}},[e._v("item.url: "+e._s(o.url))]),e._v(" "),o.url?t("div",[e.isVideo(o.url)?t("video",{staticClass:"mx-auto",staticStyle:{"max-height":"80vh"},attrs:{src:o.url.trim(),controls:""},on:{error:function(t){return e.onVideoError(o.url,r)},loadstart:function(t){return e.onMediaLoadStart(r)},loadeddata:function(t){return e.onMediaLoaded(r)}}},[e._v("\n                お使いのブラウザは動画タグをサポートしていません。\n              ")]):t("img",{staticClass:"mx-auto",staticStyle:{"max-height":"80vh",border:"2px solid blue"},attrs:{src:o.url.trim(),alt:"評価対象の画像"},on:{error:function(t){return e.onImageError(o.url,r)},load:function(t){return e.onMediaLoaded(r)}}}),e._v(" "),e.mediaErrors[r]?t("div",{staticClass:"text-center text-red-500 mt-4"},[t("p",[e._v("メディアの読み込みに失敗しました")]),e._v(" "),t("p",{staticClass:"text-sm"},[e._v("URL: "+e._s(o.url))])]):e._e()]):t("div",{staticClass:"text-center text-gray-500 mt-4"},[t("p",[e._v("URLが設定されていません")])])]),e._v(" "),t("div",{staticClass:"mx-auto mt-4 font-bold"},[e._v("\n            "+e._s(o.caption)+"\n          ")]),e._v(" "),t("div",{staticClass:"mx-auto mt-4 block"},[t("b-radio",{attrs:{"native-value":"5",type:"is-info"},model:{value:e.radio[r],callback:function(t){e.$set(e.radio,r,t)},expression:"radio[index]"}},[e._v("\n              とても良い\n            ")]),e._v(" "),t("b-radio",{attrs:{"native-value":"4",type:"is-info"},model:{value:e.radio[r],callback:function(t){e.$set(e.radio,r,t)},expression:"radio[index]"}},[e._v("\n              良い\n            ")]),e._v(" "),t("b-radio",{attrs:{"native-value":"3",type:"is-info"},model:{value:e.radio[r],callback:function(t){e.$set(e.radio,r,t)},expression:"radio[index]"}},[e._v("\n              普通\n            ")]),e._v(" "),t("b-radio",{attrs:{"native-value":"2",type:"is-info"},model:{value:e.radio[r],callback:function(t){e.$set(e.radio,r,t)},expression:"radio[index]"}},[e._v("\n              悪い\n            ")]),e._v(" "),t("b-radio",{attrs:{"native-value":"1",type:"is-info"},model:{value:e.radio[r],callback:function(t){e.$set(e.radio,r,t)},expression:"radio[index]"}},[e._v("\n              とても悪い\n            ")])],1),e._v(" "),null!=e.instruction?t("p",{staticClass:"my-auto"},[e._v("\n            "+e._s(e.instruction)+"\n          ")]):e._e()])}))],2),e._v(" "),t("div",{staticClass:"text-center"},[t("b-button",{attrs:{type:"is-primary"},on:{click:e.execute}},[e._v("次へ")]),e._v(" "),t("p",[e._v("("+e._s(e.page)+" / 20)")])],1)])])])}),[function(){var e=this,t=e._self._c;return t("ul",{staticClass:"mt-5"},[t("li",[e._v("・基本的に加点/減点方式で評価してください！")]),e._v(" "),t("li",[e._v("・無関係な単語が現れても, 的確な物体が一度でも現れていれば加点してください。")]),e._v(" "),t("li",[e._v("・無関係な単語は減点です。")]),e._v(" "),t("li",[e._v("・詳細で的確であれば「とても良い」と評価してください。")])])}],!1,null,null,null);t.default=component.exports}}]);